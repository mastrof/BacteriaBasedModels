<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Validation · Bactos.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Bactos.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li class="is-active"><a class="tocitem" href>Validation</a><ul class="internal"><li><a class="tocitem" href="#Velocity-autocorrelation-functions"><span>Velocity autocorrelation functions</span></a></li><li><a class="tocitem" href="#Mean-squared-displacement"><span>Mean-squared displacement</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Validation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Validation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mastrof/Bactos.jl/blob/main/docs/src/checks.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Validation"><a class="docs-heading-anchor" href="#Validation">Validation</a><a id="Validation-1"></a><a class="docs-heading-anchor-permalink" href="#Validation" title="Permalink"></a></h1><p>It&#39;s important to check that our microbes behave as expected. In this section, we compare various <code>Bactos.jl</code> functionalities against theoretical results from the literature. If some functionality lacks validation please open an issue.</p><h2 id="Velocity-autocorrelation-functions"><a class="docs-heading-anchor" href="#Velocity-autocorrelation-functions">Velocity autocorrelation functions</a><a id="Velocity-autocorrelation-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-autocorrelation-functions" title="Permalink"></a></h2><p>The velocity autocorrelation functions for different swimming patterns have been evaluated analytically by Taktikos et al. (2013)&lt;sup&gt;1&lt;/sup&gt;.</p><p>First, we will set identical parameters for all the swimmers. For <code>RunReverse</code> and <code>RunReverseFlick</code> we will assume that the properties in the forward and backward mode are identical.</p><pre><code class="language-julia hljs">U = 30.0 # swimming speed in μm/s
τ_run = 1.0 # average unbiased run time in s
ω = 1 / τ_run # average unbiased turn rate in 1/s
Δt = 0.01 # integration timestep in s
extent = 1e4 # domain size in μm</code></pre><p>We initialise three distinct populations, differing only in their motility, merge them all into a single population and initialise our model</p><pre><code class="language-julia hljs">n = 200 # number of microbes in each population
microbes_runtumble = [
    Microbe{3}(id=i,
        turn_rate=ω, motility=RunTumble(speed=[U])
    )
    for i in 1:n
]
microbes_runrev = [
    Microbe{3}(id=n+i,
        turn_rate=ω, motility=RunReverse(speed_forward=[U])
    )
    for i in 1:n
]
microbes_runrevflick = [
    Microbe{3}(id=2n+i,
        turn_rate=ω, motility=RunReverseFlick(speed_forward=[U])
    )
    for i in 1:n
]

microbes = vcat(
    microbes_runtumble, microbes_runrev, microbes_runrevflick
)

model = initialise_model(;
    microbes,
    extent, periodic = true,
    timestep = Δt
)</code></pre><p>To evaluate the velocity autocorrelation functions, we only need to store the <code>:vel</code> field of the microbes during the simulation. To get a good statistics we need simulation times that are sufficiently longer than the average run length <code>τ_run</code>.</p><pre><code class="language-julia hljs">nsteps = round(Int, 100τ_run / Δt)
adata = [:vel]
adf, = run!(model, microbe_step!, nsteps; adata)</code></pre><p>We can now separate the dataframes for the three subpopulations by their motility type and evaluate their velocity autocorrelation functions using the built-in <code>autocorrelation</code> function. For large amounts of data <code>autocorrelation</code> can take some time (O(t&lt;sup&gt;2&lt;/sup&gt;n)).</p><pre><code class="language-julia hljs">adf_runtumble = filter(:id =&gt; id -&gt; model.agents[id].motility isa RunTumble, adf)
adf_runrev = filter(:id =&gt; id -&gt; model.agents[id].motility isa RunReverse, adf)
adf_runrevflick = filter(:id =&gt; id -&gt; model.agents[id].motility isa RunReverseFlick, adf)
adfs = [adf_runtumble, adf_runrev, adf_runrevflick]

Φ = hcat([autocorrelation(a,:vel) for a in adfs]...)</code></pre><p>The theoretical values (normalized) are given by Taktikos et al. (2013)&lt;sup&gt;1&lt;/sup&gt;.</p><pre><code class="language-julia hljs">t = range(0, (nsteps-1)*Δt; step=Δt)
Φ_theoretical = hcat([
    exp.(-t ./ τ_run),
    exp.(-t ./ (τ_run / 2)),
    (1 .- t ./ (2τ_run)) .* exp.(-t ./ τ_run),
]...)</code></pre><p>Agreement between our simulation and theory is great.</p><pre><code class="language-julia hljs">plot(
    xlims=(0,6τ_run), ylims=(-0.1, 1.05),
    xlab=&quot;Δt / τ&quot;,
    ylab=&quot;velocity autocorrelation&quot;,
)
plot!(t, Φ_theoretical, lw=2, lc=[1 2 3], label=[&quot;Run-Tumble&quot; &quot;Run-Reverse&quot; &quot;Run-Reverse-Flick&quot;])
# slice simulation data for better visibility
scatter!(t[1:15:end], Φ[1:15:end,:] ./ U^2, m=:x, mc=[1 2 3], label=false)
hline!([0.0], lw=0.8, ls=:dash, lc=:black, lab=false)</code></pre><p><img src="../velocity_autocorrelations.png" alt="Comparison between numerical and theoretical velocity autocorrelation functions for bacteria with different motile patterns"/></p><h2 id="Mean-squared-displacement"><a class="docs-heading-anchor" href="#Mean-squared-displacement">Mean-squared displacement</a><a id="Mean-squared-displacement-1"></a><a class="docs-heading-anchor-permalink" href="#Mean-squared-displacement" title="Permalink"></a></h2><p>It&#39;s also easy to evaluate the mean-squared displacement (MSD) of our microbes during a simulation. We will now run simulations of run-tumble bacteria using different reorientation distributions (parameterized by the average inclination angle θ), and compare the MSD as a function of θ to theoretical expectations using the well-known diffusivity formula by Lovely and Dahlquist (1975)&lt;sup&gt;2&lt;/sup&gt;</p><p class="math-container">\[D = \dfrac{v^2\tau}{3(1-\alpha)}\]</p><p>where <span>$\alpha = \left&lt; \cos\theta \right&gt;$</span> represents the directional persistence of the trajectory.</p><p>Since <span>$D$</span> only depends on <span>$\left&lt; \cos\theta \right&gt;$</span> and not on the full <span>$P(\theta)$</span> distribution, we will simply use degenerate distributions <span>$P_i(\theta) = \delta(\theta-\bar\theta)$</span> for different values <span>$\bar\theta$</span> and compare the MSD estimated from our simulations to the theoretical expectation. Taktikos et al. (2013)&lt;sup&gt;1&lt;/sup&gt; provide the analytical expression for the MSD which interpolates between the short-term ballistic regime and the long-term diffusive regime:</p><p class="math-container">\[{\rm MSD}(t) = 6D\dfrac{\tau}{1-\alpha}
\left[
    \dfrac{(1-\alpha)t}{\tau}-1+
    {\rm exp}\left( -\dfrac{(1-\alpha)t}{\tau} \right)
\right]\]</p><p>We will setup our systems as usual and then run each simulation independently</p><pre><code class="language-julia hljs">using Distributions: Uniform
θs = [π/6, π/4, π/3, π/2, π]

U = 30.0 # swimming speed in μm/s 
τ = 1.0 # average run time in s 
ω = 1 / τ # average turn rate in 1/s

nmicrobes = 200
microbes = [
    [
        Microbe{3}(
            id = n, turn_rate = ω,
            motility = RunTumble(speed=[U], polar=[θ,-θ])
        ) for n in 1:nmicrobes 
    ] for θ in θs
]

dt = 0.05 # s 
L = 500.0 # μm
models = [
    initialise_model(;
        microbes = microbes[i],
        timestep = dt, extent = L
    ) for i in eachindex(microbes)
]

nsteps = round(Int, 100τ / dt)
adata = [:pos]
adfs = [run!(model, microbe_step!, nsteps; adata)[1] for model in models]</code></pre><p>We can now evaluate the MSD for each population using the <code>msd</code> function; since the simulations were performed in a periodic domain, we will need to specify the size of the domain as a keyword argument</p><pre><code class="language-julia hljs">MSD = msd.(adfs; L=L)</code></pre><p>We can now slice our experimental data and plot the results.</p><pre><code class="language-julia hljs">t = (1:nsteps).*dt
logslice = round.(Int, exp10.(range(0,3,length=10)))
plot(
    xlab = &quot;Δt / τ&quot;,
    ylab = &quot;MSD / (Uτ)²&quot;,
    legend = :bottomright, legendtitle = &quot;1-α&quot;,
    scale = :log10
)
scatter!(t[logslice]./τ, hcat(MSD...)[logslice,:]./(U*τ)^2,
    m=:x, ms=6, msw=2, lab=false)
for i in eachindex(θs)
    α = cos(θs[i])
    T = τ / (1-α)
    D = U^2*T / 3
    dr² = @. 6*D*T * (t/T - 1 + exp(-t/T))
    plot!(t./τ, dr²./(U*τ)^2, lab=round(1-α,digits=2), lc=i, lw=2)
end # for
plot!(xticks=exp10.(-1:2), yticks=exp10.(-2:2:2))</code></pre><p><img src="../msd_runtumble.png" alt="Mean-squared displacement of run-tumble bacteria with different reorientation distributions"/></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ol><li>Taktikos, J.; Stark, H.; Zaburdaev, V. How the Motility Pattern of Bacteria Affects Their Dispersal and Chemotaxis. PLoS ONE 2013, 8 (12), e81936. https://doi.org/10.1371/journal.pone.0081936.</li><li>Lovely, P.S.; Dahlquist, F.W. Statistical measures of bacterial motility and chemotaxis. Journal of Theoretical Biology 1975, 50 (2), 477-496. https://doi.org/10.1016/0022-5193(75)90094-6</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial/">« Tutorial</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 28 December 2022 01:39">Wednesday 28 December 2022</span>. Using Julia version 1.8.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
